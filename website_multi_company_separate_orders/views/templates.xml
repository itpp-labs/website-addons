<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2019 Kolushov Alexandr <https://it-projects.info/team/KolushovAlexandr>
     License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html). -->
<odoo>
    <template
        id="cart_lines"
        name="duplicate order assets"
        inherit_id="website_sale.cart_lines"
    >
        <!--        <xpath expr="//div[hasclass('oe_cart')]" position="before">-->
        <!--            <div class="col-12">-->
        <!--                Since the items in your shopping cart belong to different companies, please place an order separately-->
        <!--            </div>-->
        <!--        </xpath>-->
        <xpath expr="//td[hasclass('td-product_name')]/div" position="after">
            <t t-set="order_company" t-value="website_sale_order.company_id" />
            <t t-set="product_company_id" t-value="line.product_id.company_id.id" />
            <t t-set="website_id" t-value="website_sale_order.website_id" />
            <t
                t-if="website_id.split_orders and
            order_company.id != product_company_id and
            product_company_id in order_company.child_ids.ids and
            product_company_id not in website_sale_order.website_id.split_orders_companies.ids"
            >
                <div class="separate_order" t-attf-pcid="{{product_company_id}}">
                    (duplicate order to <t t-esc="line.product_id.company_id.name" />)
                </div>
            </t>
        </xpath>
        <xpath expr="//tbody" position="inside">
            <t
                t-set="child_lines"
                t-value="website_sale_order.order_child_ids.mapped('website_order_line')"
            />
            <t t-foreach="child_lines" t-as="line">
                <tr
                    t-att-class="'optional_product info' if line.linked_line_id else None"
                    style="opacity: 0.5;"
                >
                    <td
                        colspan="2"
                        t-if="not line.product_id.product_tmpl_id"
                        class='td-img'
                    />
                    <td
                        align="center"
                        t-if="line.product_id.product_tmpl_id"
                        class='td-img'
                    >
                        <span
                            t-field="line.product_id.image_small"
                            t-options="{'widget': 'image', 'class': 'rounded'}"
                        />
                    </td>
                    <td t-if="line.product_id.product_tmpl_id" class='td-product_name'>
                        <div>
                            <t t-call="website_sale.cart_line_product_link">
                                <strong t-field="line.name_short" />
                            </t>
                        </div>
                        <div>
                            <div class="separate_order child_order">
                                    (<t t-esc="line.order_id.company_id.name" />)
                                </div>
                        </div>
                        <t t-call="website_sale.cart_line_description_following_lines">
                            <t t-set="div_class" t-value="'d-none d-md-block'" />
                        </t>
                    </td>
                    <td class="text-center td-qty">
                        <div
                            t-if="not line.linked_line_id"
                            class="css_quantity input-group mx-auto oe_website_spinner"
                        >
                            <input
                                readonly="True"
                                type="text"
                                class="js_quantity form-control quantity"
                                t-att-data-line-id="line.id"
                                t-att-data-product-id="line.product_id.id"
                                t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty"
                            />
                        </div>
                        <t t-if="line.linked_line_id">
                            <span
                                class="js_quantity text-muted"
                                t-att-data-line-id="line.id"
                                t-att-data-product-id="line.product_id.id"
                                t-esc="int(line.product_uom_qty)"
                            />
                        </t>
                    </td>
                    <td class="text-center td-price" name="price">
                        <t
                            t-set="combination"
                            t-value="line.product_id.product_template_attribute_value_ids + line.product_no_variant_attribute_value_ids"
                        />
                        <t
                            t-set="combination_info"
                            t-value="line.product_id.product_tmpl_id._get_combination_info(combination)"
                        />
                        <t
                            t-set="list_price_converted"
                            t-value="website.currency_id._convert(combination_info['list_price'], website_sale_order.currency_id, website_sale_order.company_id, date)"
                        />
                        <t
                            groups="account.group_show_line_subtotals_tax_excluded"
                            t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxexcl) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1"
                            name="order_line_discount"
                        >
                            <del
                                t-attf-class="#{'text-danger mr8'}"
                                style="white-space: nowrap;"
                                t-esc="list_price_converted"
                                t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"
                            />
                        </t>
                        <span
                            t-field="line.price_reduce_taxexcl"
                            style="white-space: nowrap;"
                            t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"
                            groups="account.group_show_line_subtotals_tax_excluded"
                        />
                        <t
                            groups="account.group_show_line_subtotals_tax_included"
                            t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxinc) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1"
                            name="order_line_discount"
                        >
                            <del
                                t-attf-class="#{'text-danger mr8'}"
                                style="white-space: nowrap;"
                                t-esc="list_price_converted"
                                t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"
                            />
                        </t>
                        <span
                            t-field="line.price_reduce_taxinc"
                            style="white-space: nowrap;"
                            t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"
                            groups="account.group_show_line_subtotals_tax_included"
                        />
                    </td>
                    <td class="td-action">
                        </td>
                </tr>
            </t>
        </xpath>
    </template>
    <template
        id="assets_frontend"
        inherit_id="website.assets_frontend"
        name="Shop Cart"
    >
        <xpath expr="." position="inside">
            <script
                type="text/javascript"
                src="/website_multi_company_separate_orders/static/src/js/website_cart.js"
            />
            <link
                rel='stylesheet'
                href='/website_multi_company_separate_orders/static/src/css/website_cart.css'
            />
        </xpath>
    </template>
</odoo>
